services:
  logbook:
    image: ghcr.io/penguinator13/pilots-logbook:latest
    container_name: ${CONTAINER_NAME:-pilots-logbook}
    restart: unless-stopped
    ports:
      - "${HOST_PORT}:${PORT}"
    volumes:
      # Persistent storage for SQLite database
      - ${DATA_PATH}:/app/data
    environment:
      # Application settings
      NODE_ENV: production
      PORT: ${PORT}
      TZ: ${TZ}

      # Database
      DB_PATH: ${DB_PATH:-/app/data/logbook.db}

      # Security - CHANGE THESE VALUES!
      SESSION_SECRET: ${SESSION_SECRET}
      ADMIN_USERNAME: ${ADMIN_USERNAME}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD}

      # Reverse proxy support (set to true when behind nginx/cloudflare tunnel)
      TRUST_PROXY: ${TRUST_PROXY}
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://127.0.0.1:${PORT:-3000}/api/auth/me', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

volumes:
  data:
    driver: local
