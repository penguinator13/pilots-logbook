services:
  logbook:
    image: ghcr.io/penguinator13/pilots-logbook:latest
    container_name: ${CONTAINER_NAME:-pilots-logbook}
    restart: unless-stopped
    ports:
      - "${HOST_PORT:-3000}:${PORT:-3000}"
    volumes:
      # Persistent storage for SQLite database
      - ${DATA_PATH:-./data}:/app/data
    environment:
      # Application settings
      NODE_ENV: production
      PORT: ${PORT:-3000}

      # Database
      DB_PATH: ${DB_PATH:-/app/data/logbook.db}

      # Security - CHANGE THESE VALUES!
      SESSION_SECRET: ${SESSION_SECRET:-change-this-to-a-random-string-in-production}
      ADMIN_USERNAME: ${ADMIN_USERNAME:-admin}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD:-changeme}
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://127.0.0.1:${PORT:-3000}/api/auth/me', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

volumes:
  data:
    driver: local
