<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Pilot's Logbook</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <a href="/dashboard.html" class="navbar-brand">Pilot's Logbook</a>
                <button class="navbar-toggle" id="navToggle">â˜°</button>
                <ul class="navbar-nav" id="navMenu">
                    <li><a href="/dashboard.html">Dashboard</a></li>
                    <li><a href="/add-flight.html">Add Flight</a></li>
                    <li><a href="/flights.html">View Flights</a></li>
                    <li><a href="/settings.html" class="active">Settings</a></li>
                    <li><a href="#" id="logoutBtn">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container" style="padding-top: 2rem; padding-bottom: 2rem;">
        <h1 class="mb-2">Settings</h1>
        <p class="text-muted mb-4">Manage your logbook configuration</p>

        <!-- Success Alert -->
        <div id="successAlert" class="alert alert-success hidden"></div>

        <!-- Error Alert -->
        <div id="errorAlert" class="alert alert-error hidden"></div>

        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-button active" data-tab="aircraft">Aircraft Types</button>
                <button class="tab-button" data-tab="tags">Tags</button>
                <button class="tab-button" data-tab="custom-fields">Custom Fields</button>
                <button class="tab-button" data-tab="prime-logbook">Prime Logbook</button>
            </div>

            <!-- Aircraft Types Tab -->
            <div class="tab-content active" id="aircraft-tab">
                <div class="container-narrow">
                    <!-- Add Aircraft Form -->
                    <div class="card">
                        <h2 class="card-header">Add New Aircraft Type</h2>
                        <form id="addAircraftForm">
                            <div class="form-row">
                                <div class="form-group" style="flex: 1;">
                                    <label for="aircraftName" class="form-label required">Aircraft Type</label>
                                    <input type="text" id="aircraftName" name="aircraftName" class="form-input" placeholder="e.g., AS350B3+" required>
                                    <div class="form-help">Enter the aircraft model name</div>
                                </div>
                                <div class="form-group" style="display: flex; align-items: flex-end;">
                                    <button type="submit" class="btn btn-primary" id="addAircraftBtn">Add Aircraft</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Loading Spinner -->
                    <div id="aircraftLoading" class="spinner"></div>

                    <!-- Aircraft List -->
                    <div id="aircraftContainer" class="card hidden">
                        <h2 class="card-header">Your Aircraft Types</h2>
                        <div id="aircraftList">
                            <!-- Populated by JavaScript -->
                        </div>
                        <div id="noAircraft" class="text-center mt-3 hidden">
                            <p class="text-muted">No aircraft types added yet. Add your first aircraft type above.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tags Tab -->
            <div class="tab-content" id="tags-tab">
                <div class="container-narrow">
                    <!-- Add Tag Form -->
                    <div class="card">
                        <h2 class="card-header">Add New Tag</h2>
                        <p class="text-muted mb-3">Create quick-insert tags that appear on the flight entry form. Click a tag to add it as #TagName to your flight details. Maximum 10 tags.</p>
                        <form id="addTagForm">
                            <div class="form-row">
                                <div class="form-group" style="flex: 1;">
                                    <label for="tagName" class="form-label required">Tag Name</label>
                                    <input type="text" id="tagName" name="tagName" class="form-input" placeholder="e.g., Training" required pattern="[a-zA-Z0-9_-]+" maxlength="30">
                                    <div class="form-help">Letters, numbers, underscores, and hyphens only (no spaces)</div>
                                </div>
                                <div class="form-group" style="display: flex; align-items: flex-end;">
                                    <button type="submit" class="btn btn-primary" id="addTagBtn">Add Tag</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Loading Spinner -->
                    <div id="tagsLoading" class="spinner"></div>

                    <!-- Tags List -->
                    <div id="tagsContainer" class="card hidden">
                        <h2 class="card-header">Your Tags</h2>
                        <p class="text-muted mb-3">These tags will appear as clickable buttons when adding or editing flights:</p>
                        <div id="tagsList" class="tags-preview">
                            <!-- Populated by JavaScript -->
                        </div>
                        <div id="noTags" class="text-center mt-3 hidden">
                            <p class="text-muted">No tags created yet. Add your first tag above.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Custom Fields Tab -->
            <div class="tab-content" id="custom-fields-tab">
                <div class="container-narrow">
                    <!-- Add Custom Field Form -->
                    <div class="card">
                        <h2 class="card-header">Add New Custom Field</h2>
                        <p class="text-muted mb-3">Create custom hour fields that will appear in your flight entry forms for tracking specialty operations.</p>
                        <form id="addCustomFieldForm">
                            <div class="form-group">
                                <label for="fieldLabel" class="form-label required">Field Label</label>
                                <input type="text" id="fieldLabel" name="fieldLabel" class="form-input" placeholder="e.g., Hoist Operations" required>
                                <div class="form-help">The label that will appear in flight forms</div>
                            </div>
                            <div class="form-group">
                                <label for="fieldName" class="form-label required">Field Name</label>
                                <input type="text" id="fieldName" name="fieldName" class="form-input" placeholder="e.g., hoist_hours" required pattern="[a-z_]+">
                                <div class="form-help">Internal name (lowercase letters and underscores only, must end with _hours)</div>
                            </div>
                            <button type="submit" class="btn btn-primary" id="addCustomFieldBtn">Add Custom Field</button>
                        </form>
                    </div>

                    <!-- Loading Spinner -->
                    <div id="customFieldsLoading" class="spinner"></div>

                    <!-- Custom Fields List -->
                    <div id="customFieldsContainer" class="card hidden">
                        <h2 class="card-header">Custom Fields</h2>
                        <div id="customFieldsList">
                            <!-- Populated by JavaScript -->
                        </div>
                        <div id="noCustomFields" class="text-center mt-3 hidden">
                            <p class="text-muted">No custom fields added yet</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Prime Logbook Tab -->
            <div class="tab-content" id="prime-logbook-tab">
                <div class="container-narrow">
                    <div class="card">
                        <h2 class="card-header">Prime Your Logbook</h2>
                        <p class="text-muted mb-3">Import existing flight experience from your paper logbook or previous electronic system. Create a single entry per aircraft type with your total hours and experience breakdowns. After priming, you can start logging detailed individual flights.</p>

                        <form id="primeLogbookForm">
                            <!-- Date -->
                            <div class="form-group">
                                <label for="primeDate" class="form-label required">Logbook Prime Date</label>
                                <input type="date" id="primeDate" name="primeDate" class="form-input" required>
                                <div class="form-help">Select a date to mark this prime entry (e.g., the date you're starting this digital logbook)</div>
                            </div>

                            <!-- Aircraft Category -->
                            <div class="form-group">
                                <label class="form-label">Aircraft Category</label>
                                <div class="form-check">
                                    <input type="radio" id="primeCategory_helicopter" name="primeAircraftCategory" value="Helicopter" class="form-check-input" checked>
                                    <label for="primeCategory_helicopter" class="form-check-label">Helicopter</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" id="primeCategory_aeroplane" name="primeAircraftCategory" value="Aeroplane" class="form-check-input">
                                    <label for="primeCategory_aeroplane" class="form-check-label">Aeroplane</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" id="primeCategory_simulator" name="primeAircraftCategory" value="Simulator" class="form-check-input">
                                    <label for="primeCategory_simulator" class="form-check-label">Simulator</label>
                                </div>
                            </div>

                            <!-- Engine Type -->
                            <div class="form-group">
                                <label class="form-label">Engine Type</label>
                                <div class="form-check">
                                    <input type="radio" id="primeEngine_single" name="primeEngineType" value="Single Engine" class="form-check-input" checked>
                                    <label for="primeEngine_single" class="form-check-label">Single Engine</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" id="primeEngine_multi" name="primeEngineType" value="Multi Engine" class="form-check-input">
                                    <label for="primeEngine_multi" class="form-check-label">Multi Engine</label>
                                </div>
                            </div>

                            <!-- Aircraft Type -->
                            <div class="form-group">
                                <label for="primeAircraftType" class="form-label required">Aircraft Type</label>
                                <select id="primeAircraftType" name="primeAircraftType" class="form-select" required>
                                    <option value="">Select aircraft type</option>
                                </select>
                            </div>

                            <!-- Flight Time Breakdown -->
                            <div class="form-group">
                                <label class="form-label required">Flight Time Breakdown</label>
                                <div class="form-help mb-2">Enter your hours by day/night and flight role - total hours will be calculated automatically</div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="primeDayPic" class="form-label">Day PIC</label>
                                    <input type="number" id="primeDayPic" name="primeDayPic" class="form-input prime-breakdown-input" step="any" min="0" placeholder="0.0">
                                </div>
                                <div class="form-group">
                                    <label for="primeNightPic" class="form-label">Night PIC</label>
                                    <input type="number" id="primeNightPic" name="primeNightPic" class="form-input prime-breakdown-input" step="any" min="0" placeholder="0.0">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="primeDayDual" class="form-label">Day Dual</label>
                                    <input type="number" id="primeDayDual" name="primeDayDual" class="form-input prime-breakdown-input" step="any" min="0" placeholder="0.0">
                                </div>
                                <div class="form-group">
                                    <label for="primeNightDual" class="form-label">Night Dual</label>
                                    <input type="number" id="primeNightDual" name="primeNightDual" class="form-input prime-breakdown-input" step="any" min="0" placeholder="0.0">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="primeDaySic" class="form-label">Day SIC</label>
                                    <input type="number" id="primeDaySic" name="primeDaySic" class="form-input prime-breakdown-input" step="any" min="0" placeholder="0.0">
                                </div>
                                <div class="form-group">
                                    <label for="primeNightSic" class="form-label">Night SIC</label>
                                    <input type="number" id="primeNightSic" name="primeNightSic" class="form-input prime-breakdown-input" step="any" min="0" placeholder="0.0">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="primeDayCmndPractice" class="form-label">Day Comm'd Practice</label>
                                    <input type="number" id="primeDayCmndPractice" name="primeDayCmndPractice" class="form-input prime-breakdown-input" step="any" min="0" placeholder="0.0">
                                </div>
                                <div class="form-group">
                                    <label for="primeNightCmndPractice" class="form-label">Night Comm'd Practice</label>
                                    <input type="number" id="primeNightCmndPractice" name="primeNightCmndPractice" class="form-input prime-breakdown-input" step="any" min="0" placeholder="0.0">
                                </div>
                            </div>

                            <!-- Calculated Total Flight Time -->
                            <div class="form-group">
                                <label class="form-label">Total Flight Time</label>
                                <div class="calculated-total" id="primeTotalDisplay">0.0 hours</div>
                                <div class="form-help">Auto-calculated from breakdown fields above</div>
                            </div>

                            <!-- Custom Fields Container -->
                            <div id="primeCustomFieldsContainer"></div>

                            <!-- Takeoffs and Landings -->
                            <div class="form-group">
                                <label class="form-label">Takeoffs & Landings (Optional)</label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="primeTakeoffsDay" class="form-label">Day Takeoffs</label>
                                    <input type="number" id="primeTakeoffsDay" name="primeTakeoffsDay" class="form-input" min="0" value="0" placeholder="0">
                                </div>
                                <div class="form-group">
                                    <label for="primeTakeoffsNight" class="form-label">Night Takeoffs</label>
                                    <input type="number" id="primeTakeoffsNight" name="primeTakeoffsNight" class="form-input" min="0" value="0" placeholder="0">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="primeLandingsDay" class="form-label">Day Landings</label>
                                    <input type="number" id="primeLandingsDay" name="primeLandingsDay" class="form-input" min="0" value="0" placeholder="0">
                                </div>
                                <div class="form-group">
                                    <label for="primeLandingsNight" class="form-label">Night Landings</label>
                                    <input type="number" id="primeLandingsNight" name="primeLandingsNight" class="form-input" min="0" value="0" placeholder="0">
                                </div>
                            </div>

                            <!-- Form Actions -->
                            <div class="btn-group mt-3">
                                <button type="submit" class="btn btn-primary" id="primeLogbookBtn">
                                    <span id="primeSubmitText">Create Prime Entry</span>
                                </button>
                                <button type="button" class="btn btn-secondary" id="primeClearBtn">Clear Form</button>
                            </div>
                        </form>
                    </div>

                    <!-- Info Card -->
                    <div class="card">
                        <h3 class="card-header">How Prime Logbook Works</h3>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                            <li>Create one prime entry per aircraft type from your previous logbook</li>
                            <li>Enter your total hours and experience breakdowns for that aircraft</li>
                            <li>The entry will be marked with "LOGBOOK PRIME ENTRY" in the flight details</li>
                            <li>All totals will be included in your reports and summaries</li>
                            <li>After priming, start logging your new flights normally</li>
                            <li>You can create multiple prime entries for different aircraft types</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Delete Aircraft Modal -->
    <div id="deleteAircraftModal" class="modal hidden" style="display: none;">
        <div class="card" style="max-width: 400px; margin: 2rem;">
            <h2 class="card-header">Delete Aircraft Type</h2>
            <p class="mb-3">Are you sure you want to delete this aircraft type? This cannot be undone.</p>
            <div class="btn-group">
                <button id="confirmDeleteAircraftBtn" class="btn btn-danger">Delete</button>
                <button id="cancelDeleteAircraftBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Delete Custom Field Modal -->
    <div id="deleteCustomFieldModal" class="modal hidden" style="display: none;">
        <div class="card" style="max-width: 400px; margin: 2rem;">
            <h2 class="card-header">Delete Custom Field</h2>
            <p class="mb-3">Are you sure you want to delete this custom field? All data for this field will be lost. This cannot be undone.</p>
            <div class="btn-group">
                <button id="confirmDeleteCustomFieldBtn" class="btn btn-danger">Delete</button>
                <button id="cancelDeleteCustomFieldBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Delete Tag Modal -->
    <div id="deleteTagModal" class="modal hidden" style="display: none;">
        <div class="card" style="max-width: 400px; margin: 2rem;">
            <h2 class="card-header">Delete Tag</h2>
            <p class="mb-3">Are you sure you want to delete this tag? This cannot be undone.</p>
            <div class="btn-group">
                <button id="confirmDeleteTagBtn" class="btn btn-danger">Delete</button>
                <button id="cancelDeleteTagBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <style>
        .tabs-container {
            margin-top: 1rem;
        }

        .tabs-header {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin-bottom: 2rem;
            gap: 0.5rem;
        }

        .tab-button {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-button:hover {
            color: var(--primary-color);
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .aircraft-badge, .field-badge {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            margin: 0.25rem;
            font-weight: 600;
        }

        .default-aircraft-list, .default-fields-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .aircraft-item, .custom-field-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .aircraft-item:last-child, .custom-field-item:last-child {
            border-bottom: none;
        }

        .aircraft-name, .field-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.125rem;
        }

        .aircraft-meta, .field-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal.hidden {
            display: none;
        }

        .calculated-total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border-radius: 0.375rem;
            border: 2px solid var(--primary-color);
        }

        .tags-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag-item {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-weight: 600;
        }

        .tag-item .tag-name {
            font-size: 0.9rem;
        }

        .tag-item .tag-delete {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            line-height: 1;
            padding: 0;
        }

        .tag-item .tag-delete:hover {
            background: rgba(255,255,255,0.4);
        }
    </style>

    <script src="/js/common.js"></script>
    <script src="/js/settings.js"></script>
</body>
</html>
